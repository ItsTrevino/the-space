<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rumsdiagnos</title>
<style>
  html,body,#app{height:100%;margin:0}
  #app{height:100vh}
  #err{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
       background:#220000;color:#fff;font:16px/1.4 system-ui;padding:24px;white-space:pre-wrap}
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
</head>
<body>
<div id="app"></div>
<div id="err"></div>
<script>
/* ——— visa fel på skärmen om något kraschar ——— */
window.onerror = function(msg,src,ln,col,err){
  const box=document.getElementById('err');
  box.style.display='flex';
  box.textContent = 'FEL: ' + msg + (err && err.stack ? '\n\n'+err.stack : '');
};

(function(){
  const CONF = {
    room: { width: 4.0, depth: 4.1, height: 3.1, wallThickness: 0.3 },
    surfaces: { wallColor: 0xeeeeee, ceilingColor: 0xeeeeee, floorColor: 0x111111 }
  };

  const el = document.getElementById('app');
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x223344);            // mörk blågrå så vi SER något

  const camera = new THREE.PerspectiveCamera(60, el.clientWidth/el.clientHeight, 0.05, 200);
  camera.position.set(6, 2, 0);                            // stå till höger om rummet
  camera.lookAt(0, 1.3, -2.05);                            // titta mot rummets mitt

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(el.clientWidth, el.clientHeight);
  el.appendChild(renderer.domElement);

  // Ljus
  scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.2));
  const dl = new THREE.DirectionalLight(0xffffff, 0.9); dl.position.set(3,5,4); scene.add(dl);

  // Hjälpmedel
  scene.add(new THREE.GridHelper(10, 10, 0x888888, 0x444444)); // rutnät på golvet
  scene.add(new THREE.AxesHelper(1.5));                        // XYZ-axlar vid origo

  const W=CONF.room.width, D=CONF.room.depth, H=CONF.room.height, WT=CONF.room.wallThickness;
  const HALF_D=D/2;

  const matWall = new THREE.MeshStandardMaterial({ color: 0xeeeeee, roughness:0.95 });
  const matFloor= new THREE.MeshStandardMaterial({ color: 0x111111, roughness:1.0 });
  const matCeil = new THREE.MeshStandardMaterial({ color: 0xeeeeee, roughness:0.95 });

  // Golv & tak
  const floor=new THREE.Mesh(new THREE.PlaneGeometry(W,D),matFloor);
  floor.rotation.x=-Math.PI/2; floor.position.set(0,0,-HALF_D); scene.add(floor);
  const ceil=new THREE.Mesh(new THREE.PlaneGeometry(W,D),matCeil);
  ceil.rotation.x= Math.PI/2; ceil.position.set(0,H,-HALF_D); scene.add(ceil);

  // En (1) vägg framför kameran (höger vägg), så vi ser något
  const rightWall = new THREE.Mesh(new THREE.BoxGeometry(D, H, WT), matWall);
  rightWall.rotation.y = Math.PI/2;
  rightWall.position.set(W/2, H/2, -HALF_D);
  scene.add(rightWall);

  // En röd kub i mitten = synlig referens
  const box = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5),
                             new THREE.MeshStandardMaterial({color:0xff3355}));
  box.position.set(0, 0.75, -HALF_D);
  scene.add(box);

  // Säkra render-loop
  function tick(){
    box.rotation.y += 0.01;
